- @title = t('titles.users.registrations.edit')
-# - @with_map = true

-#.col-xs-12.col-sm-3.col-sm-push-9
  = tipp_panel do
    = render 'edit_help'

-#.col-xs-12.col-sm-9.col-sm-pull-3
.col-xs-12
  %h3= @title
  - if devise_mapping.confirmable? && resource.pending_reconfirmation?
    .alert.alert-warning
      = t(".text_awaiting_confirmation")
      \: #{resource.unconfirmed_email}

  = render "edit_form", resource: resource

  - if @user.articles.count < 1
    .alert.alert-notice
      = t('.use_the')
      = succeed "," do
        = link_to Stockitem.model_name.human(count: 2), user_new_article_from_stockitems_path
      = t('.to_build_up_your_inventory')

  = link_to t(".link_cancel_account"), registration_path(resource_name), data: { confirm: t(".delete_confirmation_question") }, method: :delete, class: "btn btn-default"
  = link_to t(".link_public_profile"), user_path(@user), class: "btn btn-default"

:javascript
  var onMapClick = function(e) {
    console.log("You clicked the map at " + e.latlng.lat + ", " + e.latlng.lng);
  };

  $(document).ready(function() {
    #{render 'articles/map_show.js.erb', houses: [resource.location.house], articles: resource.articles, formats: [:js]}

     var stopLocationSet = function(e) {
       // disable dragging
       markers[0].dragging.disable();

       // reset controls
       $("#set_location_remark").show();
       $("#set_location_controls").hide();

       console.log("dragging disabled");
     }

     $("#set_location_controls").hide();

     $("#set_location_link").on('click', function(e) {
       e.preventDefault();
       console.log("dragging enabled");

       // show location controls
       $("#set_location_remark").hide();
       $("#set_location_controls").show();

       // enable dragging
       markers[0].dragging.enable();
     });

     $("#cancel_set_location_link").on('click', function(e) {
       e.preventDefault();
       // reset the marker to its initial position
       markers[0].setLatLng(#{"[#{resource.location.latitude}, #{resource.location.longitude} ]"});
       stopLocationSet();
     });

     $("#finish_set_location_link").on('click', function(e) {
       e.preventDefault();
       console.log("Set location at " + markers[0].getLatLng().lat + ", " + markers[0].getLatLng().lng);

       // inform the server
       $.ajax({
         url: "#{escape_javascript(location_path(resource.location))}",
         data: {
           location: {
             latitude: markers[0].getLatLng().lat,
             longitude: markers[0].getLatLng().lng
           }
         },
         dataType: 'json',
         type: 'PUT',
         error: function(data, status) {
           console.log("Error");
           $("#modal-error").modal("show");
         },
         success: function(data, status) {
           console.log("Success");
         }
       });
       // recenter map
       map.setView(markers[0].getLatLng(), defaultZoom);

       stopLocationSet();
     });
  });
